{% extends "mingsite/base.html" %}
{% load static %}
{% block title %}Ming Dynastie ‚Äì Chinesisches Restaurant{% endblock %}

{% block content %}
  <section class="hero" id="start" aria-labelledby="hero-title">
    <div class="hero__slides" role="presentation">
      {% for slide in hero.slides %}
        {% with slide.image as img %}
          {% if img|slice:':4' == 'http' %}
            {% with resolved=img %}
              <div class="hero__slide{% if forloop.first %} is-active{% endif %}" style="background-image: url('{{ resolved }}');">
                <img src="{{ resolved }}" alt="{{ slide.alt }}">
              </div>
            {% endwith %}
          {% else %}
            {% static img as resolved %}
            <div class="hero__slide{% if forloop.first %} is-active{% endif %}" style="background-image: url('{{ resolved }}');">
              <img src="{{ resolved }}" alt="{{ slide.alt }}">
            </div>
          {% endif %}
        {% endwith %}
      {% endfor %}
    </div>

    <div class="hero__overlay hero__overlay--gradient"></div>

{% include "mingsite/partials/site_header.html" with header_scrolled=False %}


    <div class="hero__content container">
      <div class="hero__lead">
        <div class="hero__lead-logo">
          {% static hero.logo as hero_logo %}
          <img src="{{ hero_logo }}" alt="Ming Dynastie Schriftzug">
        </div>

        <h1 class="hero__title" id="hero-title">{{ hero.headline }}</h1>
        <p class="hero__description">{{ hero.description }}</p>

        <hr class="hero__rule">

        <p class="hero__description hero__description--secondary">{{ hero.secondary_description }}</p>

        <div class="hero__actions">
          {% for cta in hero.ctas %}
            <a class="button{% if cta.variant == 'outline' %} button--outline{% endif %}" href="{{ cta.href }}">{{ cta.label }}</a>
          {% endfor %}
        </div>
      </div>
    </div>
  </section>

  <div class="social-bar">
    {% for social in hero.social_links %}
      <a class="social-bar__link social-bar__link--{{ social.slug }}"
         href="{{ social.href }}" target="_blank" rel="noopener" title="{{ social.title }}">
        {% static social.icon as icon_path %}
        <img src="{{ icon_path }}" alt="{{ social.title }}">
      </a>
    {% endfor %}
  </div>

<section id="speisekarte" class="menu-section">
  <div class="menu-ui">
    <div class="menu-frame-wrap">
      <iframe
        src="https://ming-group.de/m1/menu/"
        class="menu-frame"
        title="Speisekarte"
      ></iframe>
    </div>
  </div>
</section>


  <section id="locations" class="section section--locations">
    <div class="container">
      <header class="section__header">
        <h2 class="section__title section__title--accent">Unsere Locations</h2>
      </header>
      <div class="card-grid location-grid">
        {% for location in locations %}
          <article class="location-card" id="{{ location.anchor }}">
            <div class="location-card__media">
              <img src="{{ location.image }}" alt="{{ location.name }}">
            </div>
            <div class="location-card__body">
              <h3 class="location-card__title">{{ location.name }}</h3>
              <hr class="location-card__rule">
              <ul class="location-card__details">
                {% for line in location.address_lines %}
                  <li>{{ line }}</li>
                {% endfor %}
                <li>{{ location.hours }}</li>
              </ul>
              <a class="link-arrow" href="{{ location.menu_href }}">{{ location.menu_label }}</a>
            </div>
          </article>
        {% endfor %}
      </div>
    </div>
  </section>

  <section id="delivery" class="section section--delivery">
    <div class="container">
      <header class="section__header">
        <p class="section__eyebrow">Takeaway &amp; Delivery</p>
        <p class="section__subtitle">{{ delivery.note }}</p>
      </header>
      <div class="delivery-grid">
        {% for service in delivery.services %}
          <article class="delivery-card">
            <h3 class="delivery-card__title">{{ service.location }}</h3>
            <ul class="delivery-card__links">
              {% for link in service.links %}
                <li>
                  <a href="{{ link.url }}" target="_blank" rel="noopener">
                    {% if link.logo %}
                      {% static link.logo as partner_logo %}
                      <img src="{{ partner_logo }}" alt="{{ link.logo_alt|default:link.name }}">
                    {% endif %}
                    <span>{{ link.name }}</span>
                  </a>
                </li>
              {% endfor %}
            </ul>
          </article>
        {% endfor %}
      </div>
    </div>
  </section>


  <section id="galerie" class="section section--gallery">
    <div class="container">
      <header class="section__header">
        <h2 class="section__title section__title--light">Galerie</h2>
      </header>
      <div class="gallery-grid">
        {% for image in gallery_images %}
          <figure class="gallery-grid__item">
            <img src="{{ image }}" alt="Ming Dynastie Impression">
          </figure>
        {% endfor %}
      </div>
    </div>
  </section>
<!-- ===== Galerie Lightbox (Modal) ===== -->
<div class="gallery-lightbox" id="galleryLightbox" aria-hidden="true">
  <div class="gallery-lightbox__backdrop" data-glb-close></div>

  <div class="gallery-lightbox__panel" role="dialog" aria-modal="true" aria-label="Galerie">
    <button class="gallery-lightbox__close" type="button" aria-label="Schlie√üen" data-glb-close>√ó</button>

    <button class="gallery-lightbox__nav gallery-lightbox__nav--prev" type="button" aria-label="Vorheriges Bild" data-glb-prev>
      ‚Äπ
    </button>

    <img class="gallery-lightbox__img" id="galleryLightboxImg" alt="Galerie Bild">

    <button class="gallery-lightbox__nav gallery-lightbox__nav--next" type="button" aria-label="N√§chstes Bild" data-glb-next>
      ‚Ä∫
    </button>

    <div class="gallery-lightbox__counter" id="galleryLightboxCounter">1/1</div>
  </div>
</div>

<section class="section section--testimonials" id="gaestebuch">
  <div class="container">
    <header class="section__header">
      <h2 class="section__title section__title--accent">Kundenmeinungen aus unserem G√§stebuch</h2>
    </header>

    <div class="guestbook-grid" id="guestbookGrid">
      <!-- row 1: quote / photo / quote / photo -->
<article class="guestbook-tile guestbook-tile--quote" data-type="quote">
  <div class="guestbook-tile__inner">
    <p class="guestbook-quote">"</p>
    <p class="guestbook-text"></p>
    <p class="guestbook-author"></p>
  </div>
</article>


<figure class="guestbook-tile guestbook-tile--photo" data-type="photo">
  <div class="guestbook-tile__inner">
    <img alt="Ming Dynastie Impression">
  </div>
</figure>



<article class="guestbook-tile guestbook-tile--quote" data-type="quote">
  <div class="guestbook-tile__inner">
    <p class="guestbook-quote">"</p>
    <p class="guestbook-text"></p>
    <p class="guestbook-author"></p>
  </div>
</article>


<figure class="guestbook-tile guestbook-tile--photo" data-type="photo">
  <div class="guestbook-tile__inner">
    <img alt="Ming Dynastie Impression">
  </div>
</figure>

      <!-- row 2: photo / quote / photo / quote -->
<figure class="guestbook-tile guestbook-tile--photo" data-type="photo">
  <div class="guestbook-tile__inner">
    <img alt="Ming Dynastie Impression">
  </div>
</figure>

<article class="guestbook-tile guestbook-tile--quote" data-type="quote">
  <div class="guestbook-tile__inner">
    <p class="guestbook-quote">"</p>
    <p class="guestbook-text"></p>
    <p class="guestbook-author"></p>
  </div>
</article>

<figure class="guestbook-tile guestbook-tile--photo" data-type="photo">
  <div class="guestbook-tile__inner">
    <img alt="Ming Dynastie Impression">
  </div>
</figure>

<article class="guestbook-tile guestbook-tile--quote" data-type="quote">
  <div class="guestbook-tile__inner">
    <p class="guestbook-quote">"</p>
    <p class="guestbook-text"></p>
    <p class="guestbook-author"></p>
  </div>
</article>
    </div>
  </div>

  <!-- data for the animation (quotes + food photos) -->
  <script id="guestbookTestimonials" type="application/json">
  [
    {% for t in testimonials %}
      {"quote":"{{ t.quote|escapejs }}","author":"{{ t.author|default:''|escapejs }}"}{% if not forloop.last %},{% endif %}
    {% endfor %}
  ]
  </script>

  <script id="guestbookImages" type="application/json">
  [
    {% for img in gallery_images %}
      "{{ img|escapejs }}"{% if not forloop.last %},{% endif %}
    {% endfor %}
  ]
  </script>
</section>



<section id="kontakt" class="section section--contact">
  <div class="container">
    <header class="section__header section__header--center">
      <h2 class="section__title section__title--kontakt">Kontakt</h2>
    </header>

    <div class="kontakt-grid">
      <!-- Card 1 -->
      <article class="kontakt-card">
        <div class="kontakt-card__map">
          <!-- Replace src with your real Google Maps embed link -->
          <iframe
            src="https://www.google.com/maps/embed?pb=YOUR_JANNOWITZ_EMBED"
            loading="lazy"
            referrerpolicy="no-referrer-when-downgrade"
            allowfullscreen
          ></iframe>
        </div>

        <div class="kontakt-card__body">
          <h3 class="kontakt-card__title">Ming Dynastie Jannowitzbr√ºcke</h3>
          <div class="kontakt-card__rule"></div>

          <p class="kontakt-card__text">Br√ºckenstra√üe 6<br>10179 Berlin</p>

          <p class="kontakt-card__text">
            Tel.: 030 - 308 756 80<br>
            Fax: 030 - 308 756 81
          </p>

          <p class="kontakt-card__text">Mo - So: 12:00 - 22:00 Uhr</p>

          <p class="kontakt-card__small">
            Reservierungen ab sieben Personen k√∂nnen per E-Mail angefragt werden.
          </p>

        <div class="kontakt-card__actions">
          <a class="kontakt-card__btn" href="mailto:info@ming-dynastie.de">E-MAIL SCHREIBEN</a>

          <button
            class="kontakt-card__btn kontakt-card__btn--outline"
            type="button"
            data-open-jannowitz-resv>
            RESERVIEREN
          </button>
        </div>

        </div>
      </article>

      <!-- Card 2 -->
      <article class="kontakt-card">
        <div class="kontakt-card__map">
          <!-- Replace src with your real Google Maps embed link -->
          <iframe
            src="https://www.google.com/maps/embed?pb=YOUR_EUROPA_EMBED"
            loading="lazy"
            referrerpolicy="no-referrer-when-downgrade"
            allowfullscreen
          ></iframe>
        </div>

        <div class="kontakt-card__body">
          <h3 class="kontakt-card__title">Ming Dynastie Europa-Center</h3>
          <div class="kontakt-card__rule"></div>

          <p class="kontakt-card__text">Tauentzienstra√üe 9-12<br>10789 Berlin</p>

          <p class="kontakt-card__text">
            Tel.: 030 - 257 598 86<br>
            Fax: 030 - 25 759 899
          </p>

          <p class="kontakt-card__text">Mo - So: 12:00 - 22:00 Uhr</p>

          <p class="kontakt-card__small">
            Reservierungen ab sieben Personen k√∂nnen per E-Mail angefragt werden.
          </p>

          <a class="kontakt-card__btn" href="mailto:info@ming-dynastie.de">E-MAIL SCHREIBEN</a>
        </div>
      </article>
    </div>
  </div>
</section>

<section class="section section--contact" id="my-reservations">
  <div class="container">
    <header class="section__header section__header--center">
      <h2 class="section__title section__title--kontakt">Meine Reservierungen</h2>
    </header>

    <article class="kontakt-card" style="max-width: 980px; margin: 0 auto;">
      <div class="kontakt-card__body">
        <div id="myResvInline">
          <!-- JS will inject content here -->
          <div style="padding: 14px 0; color: rgba(0,0,0,.55);">
            Lade‚Ä¶
          </div>
        </div>
      </div>
    </article>
  </div>
</section>

<!-- =========================
     JANNOWITZ RESERVATION MODAL
========================= -->
<div class="resv-modal" id="jannowitzResvModal" aria-hidden="true">
  <div class="resv-modal__backdrop" data-resv-close></div>

  <div class="resv-modal__panel" role="dialog" aria-modal="true" aria-label="Reservierung Jannowitzbr√ºcke">
    <button class="resv-modal__close" type="button" aria-label="Schlie√üen" data-resv-close>‚úï</button>

    <div id="jannowitzModalBody">
    <h3 class="resv-modal__title">Reservierung ‚Äì Jannowitzbr√ºcke</h3>
    <p class="resv-modal__subtitle">Br√ºckenstra√üe 6 ¬∑ 10179 Berlin</p>

    <form id="jannowitz-form" method="post" action="{% url 'reservations:create' %}">
      {% csrf_token %}

      <div class="form-grid">
        <label class="form-field">
          <span>Name</span>
          <input name="name" required autocomplete="name">
        </label>

        <label class="form-field">
          <span>E-Mail</span>
          <input name="email" type="email" required autocomplete="email">
        </label>

        <label class="form-field">
          <span>Telefon</span>
          <input name="phone" required autocomplete="tel">
        </label>

        <label class="form-field">
          <span>Datum</span>
          <input id="jannowitz-date" name="date" type="text" placeholder="dd.mm.yyyy" required />
        </label>


        <!-- Hover Tooltip -->
<div id="shortTermHint" style="
  position: fixed;
  display: none;
  z-index: 999999;
  left: 50%;
  bottom: 24px;
  transform: translateX(-50%);
  max-width: 92vw;
  padding: 10px 12px;
  border-radius: 12px;
  background: rgba(20,20,20,0.95);
  color: #fff;
  font-size: 14px;
  line-height: 1.35;
  box-shadow: 0 10px 30px rgba(0,0,0,0.25);
"></div>


        <label class="form-field">
          <span>Anzahl Personen</span>
          <input name="party_size" id="jannowitz-party" type="number" min="1" max="100" required>
        </label>
        
        <label class="form-field">
          <span>Uhrzeit</span>

          <select name="time" id="id_time" required>
            <option value="">Bitte Uhrzeit w√§hlen</option>
          </select>

        </label>


        <label class="form-field form-grid__wide">
          <span>Nachricht an das Restaurant</span>
          <textarea name="message" rows="3" placeholder="Optional ‚Ä¶"></textarea>
        </label>
      </div>

      <div class="form-actions">
        <button class="kontakt-card__btn" id="jannowitz-submit" type="submit">
          <span class="btn-text">TISCH RESERVIEREN</span>
          <span class="btn-loader" style="display:none;">Sende‚Ä¶</span>
        </button>
      </div>

      <div id="jannowitz-status"></div>
    </form>
  </div>
  </div>
</div>

<!-- ===== Call Restaurant Popup ===== -->
<div class="resv-popup" id="resvCallPopup" aria-hidden="true">
  <div class="resv-popup__backdrop" data-call-close></div>

  <div class="resv-popup__panel" role="dialog" aria-modal="true" aria-label="Bitte anrufen">
  <h3 class="resv-popup__title" id="resvPopupTitle">
    <!-- dynamic -->
  </h3>

  <p class="resv-popup__text" id="resvPopupText">
    <!-- dynamic -->
  </p>


    <div class="resv-popup__actions">
      <!-- Call Button -->
      <a 
        href="tel:+493030875680"
        class="kontakt-card__btn"
      >
        üìû 030 - 308 756 80
      </a>

      <!-- Close Button -->
      <button 
        class="kontakt-card__btn kontakt-card__btn--outline" 
        type="button" 
        data-call-close
      >
        OK
      </button>
    </div>
  </div>
</div>


<!-- ===== My Reservations Modal ===== -->
<div class="resv-modal" id="myResvModal" aria-hidden="true">
  <div class="resv-modal__backdrop" data-myresv-close></div>

  <div class="resv-modal__panel" role="dialog" aria-modal="true" aria-label="Meine Reservierungen">
    <button class="resv-modal__close" type="button" aria-label="Close" data-myresv-close>‚úï</button>
    <div id="myResvModalBody"></div>
  </div>
</div>


{% endblock %}

{% block footer %}
{% include "mingsite/partials/site_footer.html" %}
{% endblock %}


{% block extra_scripts %}
  <style>
    /* Mobile UI polish for reservation card (UI only, no logic changes) */
    @media (max-width: 900px) {
      .contact-grid {
        grid-template-columns: 1fr !important;
        gap: 1.25rem !important;
      }
      .contact-card {
        width: 100%;
      }
      .form-grid {
        grid-template-columns: 1fr !important;
        gap: 0.9rem !important;
      }
      .form-grid__wide {
        grid-column: 1 / -1 !important;
      }
      .form-actions {
        display: flex;
        justify-content: center;
        margin-top: 1rem;
      }
      #jannowitz-submit {
        width: min(220px, 100%);
      }
    }

    /* Status box (works desktop + mobile) */
    #jannowitz-status.form-status {
      margin-top: 14px;
      padding: 12px 14px;
      border-radius: 14px;
      font-size: 0.95rem;
      line-height: 1.5;
    }
    #jannowitz-status.form-status--ok {
      background: rgba(46, 125, 50, 0.12);
      border: 1px solid rgba(46, 125, 50, 0.25);
      color: #1b5e20;
    }
    #jannowitz-status.form-status--err {
      background: rgba(211, 47, 47, 0.10);
      border: 1px solid rgba(211, 47, 47, 0.25);
      color: #b71c1c;
    }
/* ===== Header like screenshot (sticky + white on scroll) ===== */
.hero__nav-wrapper{
  position: fixed !important;
  top: 0;
  left: 0;
  right: 0;

  bottom: auto !important;

  height: 120px;            /* üî• bigger so it doesn't cut */
  z-index: 9999;

  background: transparent;
  box-shadow: none;
  transition: background .2s ease, box-shadow .2s ease;

  overflow: hidden;         /* üî• prevents "half on image" look */
}

/* kill any overlay pseudo elements if they exist in base css */
.hero__nav-wrapper::before,
.hero__nav-wrapper::after{
  content: none !important;
}


/* when scrolled: white bar like screenshot */
.hero__nav-wrapper.is-scrolled{
  background: #fff;
  box-shadow: 0 8px 18px rgba(0,0,0,.08);
}

.hero__nav{
  height: 100%;
  display: flex;
  align-items: center;
  gap: 28px;
  padding: 18px 0;          /* üî• gives room for the red lines */
}

/* logo left */
.hero__brand{
  display: inline-flex;
  align-items: center;
  text-decoration: none;
}
.hero__brand img{
  height: 56px;
  width: auto;
  display: block;
}

/* menu center */
.hero__menu{
  flex: 1;
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 32px;
}

/* link typography */
.hero__menu-link{
  text-decoration: none;
  text-transform: uppercase;
  letter-spacing: .08em;
  white-space: nowrap;
  font-weight: 500;
  font-size: 16px;
  color: rgba(255,255,255,.92);   /* TOP: white on hero */
}

/* AFTER scroll: dark text on white header */
.hero__nav-wrapper.is-scrolled .hero__menu-link{
  color: #444;
}

.hero__menu-link span{
  position: relative;
  display: inline-block;
  padding: 8px 0;
}

/* red top & bottom lines for active/hover (like screenshot) */
.hero__menu-link span::before,
.hero__menu-link span::after{
  content: "";
  position: absolute;
  left: 0;
  right: 0;
  height: 3px;
  background: #b61f2a;
  transform: scaleX(0);
  transition: transform .18s ease;
}
.hero__menu-link span::before { top: 0; }
.hero__menu-link span::after  { bottom: 0; }


.hero__menu-link:hover span::before,
.hero__menu-link:hover span::after,
.hero__menu-link.is-active span::before,
.hero__menu-link.is-active span::after{
  transform: scaleX(1);
}

/* mobile: keep it usable */
@media (max-width: 900px){
  .hero__nav{ min-height: 76px; }
  .hero__brand img{ height: 44px; }
  .hero__menu{
    justify-content: flex-start;
    gap: 20px;
    overflow-x: auto;
    white-space: nowrap;
    scrollbar-width: none;
  }
  .hero__menu::-webkit-scrollbar{ display:none; }
  .hero__menu-link{ font-size: 15px; }
}
.hero{
  padding-top: 120px;
}

section{
  scroll-margin-top: 120px; /* so clicking #links doesn't hide titles under header */
}
/* ===== Locations section like ming-dynastie.de (your 2nd screenshot) ===== */

.section--locations{
  padding: 70px 0 90px;
  background: #efefef;
  /* soft pattern vibe (CSS-only) */
  background-image:
    radial-gradient(circle at 15% 35%, rgba(255,255,255,.6) 0 2px, transparent 3px 100%),
    radial-gradient(circle at 75% 65%, rgba(255,255,255,.55) 0 2px, transparent 3px 100%),
    radial-gradient(circle at 45% 15%, rgba(255,255,255,.35) 0 1px, transparent 2px 100%);
  background-size: 120px 120px, 140px 140px, 90px 90px;
}

/* two-column grid */
.location-grid{
  display: grid !important;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 40px;
  align-items: start;
}

/* card look */
.location-card{
  background: rgba(255,255,255,.92);
  border-radius: 26px;
  overflow: hidden;
  box-shadow: 0 18px 45px rgba(0,0,0,.18);
  transform: translateZ(0);
  transition: transform .18s ease, box-shadow .18s ease;
}

.location-card:hover{
  transform: translateY(-4px);
  box-shadow: 0 26px 65px rgba(0,0,0,.20);
}

/* image */
.location-card__media{
  aspect-ratio: 16 / 9;
  background: #ddd;
}
.location-card__media img{
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
}

/* body */
.location-card__body{
  padding: 26px 32px 26px;
}

.location-card__title{
  margin: 0 0 14px;
  font-size: 30px;
  font-weight: 500;
  color: #2f2f2f;
}

/* blue divider line under title */
.location-card__rule{
  border: 0;
  height: 2px;
  background: rgba(39, 84, 170, .65);
  margin: 0 0 18px;
}

/* details */
.location-card__details{
  list-style: none;
  padding: 0;
  margin: 0 0 18px;
}
.location-card__details li{
  font-size: 18px;
  line-height: 1.65;
  color: #2f2f2f;
}

/* first address lines red like screenshot */
.location-card__details li:nth-child(-n+2){
  color: #a11f24;
}

/* hours slightly muted */
.location-card__details li:last-child{
  color: rgba(0,0,0,.65);
  margin-top: 18px;
}

/* bottom right arrow link */
.link-arrow{
  display: inline-flex;
  align-items: center;
  justify-content: flex-end;
  gap: 12px;
  width: 100%;
  color: #a11f24;
  font-weight: 700;
  text-decoration: none;
}
.link-arrow::after{
  content: "‚Ä∫‚Ä∫";
  font-size: 22px;
  line-height: 1;
  transform: translateY(1px);
}
.link-arrow:hover{
  text-decoration: underline;
}

/* responsive */
@media (max-width: 1000px){
  .location-grid{
    grid-template-columns: 1fr;
    gap: 26px;
  }
  .location-card__title{ font-size: 26px; }
  .location-card__body{ padding: 22px 22px 22px; }
}
/* ===== DELIVERY: match ming-dynastie.de brightness (single source of truth) ===== */
.section--delivery{
  position: relative !important;
  padding: 90px 0 90px !important;
  color: #fff !important;

  background-position: center !important;
  background-size: cover !important;
  background-repeat: no-repeat !important;

  overflow: hidden !important;
}

/* remove darkening ‚Äî use a LIGHT wash instead */
.section--delivery::before{
  content: "" !important;
  position: absolute !important;
  inset: 0 !important;

  /* brighter + slightly warm like the reference */
  background: rgba(255,255,255,.22) !important;
  mix-blend-mode: screen !important;

  pointer-events: none !important;
  z-index: 0 !important;
}

/* boost ONLY the background brightness (does not affect text/cards) */
.section--delivery::after{
  content: "" !important;
  position: absolute !important;
  inset: 0 !important;

  background: transparent !important;

  /* this is the key */
  -webkit-backdrop-filter: brightness(1.45) saturate(1.15) contrast(1.05) !important;
  backdrop-filter: brightness(1.35) saturate(1.15) contrast(1.05) !important;

  pointer-events: none !important;
  z-index: 0 !important;
}

/* keep delivery content above overlays */
.section--delivery .container{
  position: relative !important;
  z-index: 1 !important;
}
/* ===== GALERIE (match ming-dynastie.de screenshot) ===== */

/* full-width red section already exists in base, so only layout + hover fix */
.section--gallery{
  padding: 70px 0 90px !important;
}

/* big centered title like screenshot */
.section--gallery .section__header{
  text-align: center !important;
  margin-bottom: 34px !important;
}
.section--gallery .section__title{
  font-size: 64px !important;
  line-height: 1 !important;
  margin: 0 !important;
}

/* grid like screenshot: 4 columns, 2 rows */
.gallery-grid{
  display: grid !important;
  grid-template-columns: repeat(4, minmax(0, 1fr)) !important;
  gap: 18px !important;
  align-items: stretch !important;
}

/* kill any base styles that make them "small rounded cards" */
.gallery-grid__item{
  margin: 0 !important;
  border-radius: 0 !important;
  overflow: hidden !important;
  background: transparent !important;
  box-shadow: none !important;
  position: relative !important;

  /* consistent tile height like screenshot */
  aspect-ratio: 4 / 3 !important;
}

/* image fills the tile */
.gallery-grid__item img{
  width: 100% !important;
  height: 100% !important;
  object-fit: cover !important;
  display: block !important;

  /* IMPORTANT: prevent "all images change color" hover bug */
  filter: none !important;
  opacity: 1 !important;
  transform: none !important;
  transition: transform .18s ease, filter .18s ease !important;
}

/* hovered image gets the light wash (others DO NOT change) */
.gallery-grid__item::after{
  content: "" !important;
  position: absolute !important;
  inset: 0 !important;
  background: transparent !important;
  transition: background .18s ease !important;
  pointer-events: none !important;
}

.gallery-grid__item:hover img{
  transform: scale(1.02) !important;
}

.gallery-grid__item:hover::after{
  /* light ‚Äúpink/white wash‚Äù like screenshot */
  background: rgba(255, 255, 255, 0.35) !important;
}

/* EXTRA SAFETY: if any base css dims ALL images on hover, cancel it */
.gallery-grid:hover img{
  filter: none !important;
  opacity: 1 !important;
}

/* responsive */
@media (max-width: 1100px){
  .gallery-grid{ grid-template-columns: repeat(2, minmax(0, 1fr)) !important; }
}
@media (max-width: 600px){
  .gallery-grid{ grid-template-columns: 1fr !important; }
  .section--gallery .section__title{ font-size: 44px !important; }
}
/* =========================
   GALERIE ‚Äì layout + hover
   ========================= */

/* keep tiles like reference (big rectangular) */
.gallery-grid{
  display: grid !important;
  grid-template-columns: repeat(4, minmax(0, 1fr)) !important;
  gap: 18px !important;
}

.gallery-grid__item{
  position: relative !important;
  margin: 0 !important;
  overflow: hidden !important;
  border-radius: 0 !important;
  aspect-ratio: 4 / 3 !important;
  cursor: pointer !important;
}

.gallery-grid__item img{
  width: 100% !important;
  height: 100% !important;
  object-fit: cover !important;
  display: block !important;
}

/* overlay layer on each tile */
.gallery-grid__item::after{
  content: "" !important;
  position: absolute !important;
  inset: 0 !important;
  background: transparent !important;
  transition: background .15s ease !important;
  pointer-events: none !important;
}

/* IMPORTANT: When hovering the grid, tint ALL items red... */
.gallery-grid:hover .gallery-grid__item::after{
  background: rgba(182, 31, 42, 0.22) !important; /* red tint */
}

/* ...but keep the hovered item NORMAL (no tint) */
.gallery-grid:hover .gallery-grid__item:hover::after{
  background: transparent !important;
}

/* no image color changes on hover (only overlays) */
.gallery-grid:hover img{
  filter: none !important;
  opacity: 1 !important;
  transform: none !important;
}

/* responsive */
@media (max-width: 1100px){
  .gallery-grid{ grid-template-columns: repeat(2, minmax(0, 1fr)) !important; }
}
@media (max-width: 600px){
  .gallery-grid{ grid-template-columns: 1fr !important; }
}


/* =========================
   LIGHTBOX (modal)
   ========================= */

.gallery-lightbox{
  position: fixed;
  inset: 0;
  z-index: 20000; /* above header */
  display: none;
}

.gallery-lightbox.is-open{
  display: block;
}

.gallery-lightbox__backdrop{
  position: absolute;
  inset: 0;
  background: rgba(0,0,0,.78);
}

/* centered white panel like screenshot */
.gallery-lightbox__panel{
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);

  width: min(1180px, 92vw);
  height: min(720px, 82vh);

  background: rgba(255,255,255,.92);
  box-shadow: 0 30px 80px rgba(0,0,0,.55);
  border-radius: 4px;

  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
}

/* big image */
.gallery-lightbox__img{
  max-width: 100%;
  max-height: 100%;
  width: 100%;
  height: 100%;
  object-fit: contain;
}

/* close X top-right */
.gallery-lightbox__close{
  position: absolute;
  top: 10px;
  right: 14px;
  z-index: 2;

  width: 44px;
  height: 44px;
  border: 0;
  background: transparent;
  color: rgba(0,0,0,.65);
  font-size: 34px;
  cursor: pointer;
}

/* arrows */
.gallery-lightbox__nav{
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  z-index: 2;

  width: 56px;
  height: 90px;

  border: 0;
  background: rgba(0,0,0,.35);
  color: #fff;
  font-size: 44px;
  line-height: 1;
  cursor: pointer;
}

.gallery-lightbox__nav--prev{ left: 10px; }
.gallery-lightbox__nav--next{ right: 10px; }

/* counter bottom-right */
.gallery-lightbox__counter{
  position: absolute;
  right: 14px;
  bottom: 10px;
  z-index: 2;
  color: rgba(0,0,0,.65);
  font-size: 14px;
}
/* ===== G√§stebuch (match reference layout + sizing) ===== */

.section--testimonials{
  padding: 60px 0 80px !important;
  background: #e9e9e9 !important;
  /* subtle pattern like the reference */
  background-image:
    radial-gradient(circle at 12% 28%, rgba(255,255,255,.55) 0 2px, transparent 3px 100%),
    radial-gradient(circle at 68% 40%, rgba(255,255,255,.45) 0 2px, transparent 3px 100%),
    radial-gradient(circle at 40% 78%, rgba(255,255,255,.35) 0 2px, transparent 3px 100%);
  background-size: 140px 140px, 160px 160px, 180px 180px;
}

.section--testimonials .section__header{
  text-align: center !important;
  margin-bottom: 28px !important;
}

.section--testimonials .section__title--accent{
  color: #8d1a1f !important;
  font-size: 40px !important;
  line-height: 1.05 !important;
  margin: 0 !important;
  font-weight: 700 !important;
}

/* IMPORTANT: remove default figure margins (this is a big reason it looks broken) */
.guestbook-grid,
.guestbook-grid figure,
.guestbook-grid article{
  margin: 0 !important;
  padding: 0 !important;
}

/* 4x2 collage grid ‚Äì tiles touch */
.guestbook-grid{
  --gb-gap: 14px; /* <-- the small consistent space */
  gap: var(--gb-gap) !important;
}

/* exact same height for ALL tiles */
.guestbook-tile{
  position: relative;
  height: 250px !important;
  overflow: visible !important;   /* IMPORTANT */
  border-radius: 0 !important;
  z-index: 0;
}

.guestbook-tile__inner{
  height: 100%;
  width: 100%;
  overflow: hidden;
  border-radius: 14px;
  transform: translateZ(0);
  transition: transform 260ms ease, box-shadow 260ms ease;
  box-shadow: 0 10px 26px rgba(0,0,0,.14);
}
/* photo tiles */
.guestbook-tile--photo{
  background: transparent !important;
}
.guestbook-tile--photo img{
  width: 100% !important;
  height: 100% !important;
  object-fit: cover !important;
  display: block !important;
}

/* quote tiles (light transparent panel like reference) */
.guestbook-tile--quote .guestbook-tile__inner{
  background: rgba(255,255,255,.70);
  display: flex;
  flex-direction: column;
  justify-content: center;
  text-align: center;
  padding: 22px 22px;
}

.guestbook-quote{ display: none !important; }

.guestbook-text{
  margin: 0 0 16px !important;
  color: #1f3f90 !important;      /* blue like reference */
  font-size: 18px !important;
  line-height: 1.45 !important;
  font-weight: 700 !important;
}

.guestbook-author{
  margin: 0 !important;
  color: #222 !important;
  font-size: 18px !important;
  font-weight: 500 !important;
}

/* reveal-once animation (like the video, no continuous swapping) */
.guestbook-tile{
  opacity: 0;
  transform: translateY(14px);
  transition: opacity .35s ease, transform .35s ease;
  transition-delay: var(--d, 0ms);
}
.guestbook-tile.is-revealed{
  opacity: 1;
  transform: translateY(0);
}

/* responsive */
@media (max-width: 1100px){
  .guestbook-grid{ grid-template-columns: repeat(2, 1fr) !important; }
  .section--testimonials .section__title--accent{ font-size: 42px !important; }
}
@media (max-width: 650px){
  .guestbook-grid{ grid-template-columns: 1fr !important; }
}

/* Reduced motion */
@media (prefers-reduced-motion: reduce){
  .guestbook-tile__inner{ transition: none !important; }
}

/* ===== FIX: G√§stebuch grid + ‚Äúfill the gap‚Äù hover ===== */
#gaestebuch .guestbook-grid{
  --gb-gap: 14px;
  display: grid !important;
  grid-template-columns: repeat(4, minmax(0, 1fr)) !important;
  gap: var(--gb-gap) !important;
  align-items: stretch !important;
}

/* equal size tiles */
#gaestebuch .guestbook-tile{
  height: 250px !important;
  position: relative !important;
  overflow: visible !important; /* allow expansion into the gap */
  z-index: 0;
}

/* inner clips content */
#gaestebuch .guestbook-tile__inner{
  height: 100% !important;
  width: 100% !important;
  overflow: hidden !important;
  border-radius: 14px !important;
  position: relative !important;
  z-index: 2 !important;

  /* IMPORTANT: cancel any scaling you added earlier */
  transform: none !important;
}

/* this is the expanding layer that ‚Äúcovers‚Äù the gap */
#gaestebuch .guestbook-tile::after{
  content: "" !important;
  position: absolute !important;
  inset: 0 !important;
  border-radius: 14px !important;
  z-index: 1 !important;
  pointer-events: none !important;

  transition: inset 260ms ease, box-shadow 260ms ease, border-radius 260ms ease !important;
  box-shadow: 0 10px 26px rgba(0,0,0,.14) !important;
  background: transparent !important;
}

/* quote tiles keep the light panel look */
#gaestebuch .guestbook-tile--quote::after{
  background: rgba(255,255,255,.70) !important;
}

/* hover: expand exactly into the gap (so the gap disappears visually) */
#gaestebuch .guestbook-tile:hover{
  z-index: 20;
}
#gaestebuch .guestbook-tile:hover::after{
  inset: calc(var(--gb-gap) / -2) !important;  /* fills the gap */
  border-radius: 18px !important;
  box-shadow: 0 22px 60px rgba(0,0,0,.22) !important;
}

/* photo fills */
#gaestebuch .guestbook-tile--photo img{
  width: 100% !important;
  height: 100% !important;
  object-fit: cover !important;
  display: block !important;
}

/* responsive */
@media (max-width: 1100px){
  #gaestebuch .guestbook-grid{
    grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
  }
}
@media (max-width: 650px){
  #gaestebuch .guestbook-grid{
    grid-template-columns: 1fr !important;
  }
}

/* ===== Kontakt section like screenshot ===== */
.section--contact{
  padding: 60px 0 90px !important;
  background: #ececec !important;
  background-image:
    radial-gradient(circle at 12% 28%, rgba(255,255,255,.60) 0 2px, transparent 3px 100%),
    radial-gradient(circle at 70% 42%, rgba(255,255,255,.45) 0 2px, transparent 3px 100%),
    radial-gradient(circle at 38% 78%, rgba(255,255,255,.35) 0 2px, transparent 3px 100%);
  background-size: 160px 160px, 190px 190px, 220px 220px;
}

.section__header--center{
  text-align: center;
  margin-bottom: 28px;
}

.section__title--kontakt{
  font-size: 44px;
  color: #1f3f90; /* blue like screenshot */
  font-weight: 700;
  margin: 0;
}

.kontakt-grid{
  display: grid;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 56px;
  align-items: start;
}

/* card */
.kontakt-card{
  background: rgba(255,255,255,.85);
  border-radius: 0;
  overflow: hidden;
  box-shadow: 0 14px 36px rgba(0,0,0,.12);
}

/* map area */
.kontakt-card__map{
  width: 100%;
  height: 230px;
  background: #ddd;
}
.kontakt-card__map iframe{
  width: 100%;
  height: 100%;
  border: 0;
  display: block;
}

/* body */
.kontakt-card__body{
  padding: 22px 26px 26px;
}

.kontakt-card__title{
  margin: 0 0 12px;
  font-size: 24px;
  font-weight: 700;
  color: #111;
}

.kontakt-card__rule{
  height: 2px;
  width: 100%;
  background: rgba(31,63,144,.35);
  margin: 0 0 16px;
}

.kontakt-card__text{
  margin: 0 0 14px;
  color: #333;
  line-height: 1.5;
  font-size: 14px;
}

.kontakt-card__small{
  margin: 10px 0 18px;
  color: #444;
  font-size: 12.5px;
  line-height: 1.4;
}

.kontakt-card__btn{
  display: inline-block;
  padding: 10px 18px;
  border-radius: 999px;
  background: #8d1a1f;
  color: #fff;
  text-decoration: none;
  font-weight: 700;
  font-size: 12px;
  letter-spacing: .06em;
}

.kontakt-card__actions{
  display: flex;
  gap: 12px;
  flex-wrap: wrap;
}

.kontakt-card__btn--outline{
  background: transparent !important;
  color: #8d1a1f !important;
  border: 2px solid rgba(141,26,31,.55) !important;
}

/* responsive */
@media (max-width: 980px){
  .kontakt-grid{ grid-template-columns: 1fr; gap: 22px; }
  .section__title--kontakt{ font-size: 36px; }
}

/* ===== Footer like screenshot (red block + lantern row) ===== */
.ming-footer{
  margin-top: 0;
}

/* big red section */
.ming-footer__top{
  position: relative;
  background: #8f1f2a;
  color: rgba(255,255,255,.9);
}

/* subtle pattern overlay (keeps it ‚Äúnot flat‚Äù, without darkening) */
.ming-footer__top::before{
  content:"";
  position:absolute;
  inset:0;
  pointer-events:none;
  opacity:.12;
  background-image:
    radial-gradient(circle at 20% 20%, rgba(255,255,255,.25) 0 2px, transparent 3px),
    radial-gradient(circle at 70% 40%, rgba(255,255,255,.18) 0 2px, transparent 3px),
    radial-gradient(circle at 40% 80%, rgba(255,255,255,.18) 0 2px, transparent 3px);
  background-size: 220px 220px;
}

.ming-footer__top-inner{
  position: relative;
  padding: 90px 0 40px;
  text-align: center;
}

.ming-footer__kicker{
  margin: 0 0 42px;
  font-size: 18px;
  letter-spacing: .3px;
  color: rgba(255,255,255,.9);
}

.ming-footer__lanterns{
  display: flex;
  justify-content: center;
  align-items: flex-start;
  gap: min(90px, 6vw);
  margin: 0 auto 48px;
  flex-wrap: wrap;
}

.ming-footer__lantern{
  text-decoration: none;
  color: rgba(255,255,255,.95);
  display: inline-flex;
  flex-direction: column;
  align-items: center;
  gap: 14px;
  min-width: 180px;
}

.ming-footer__lantern-icon{
  color: #d6a864; /* gold */
  display: inline-flex;
}

.lantern-svg{
  width: 78px;
  height: 140px;
  display: block;
}

.ming-footer__lantern-text{
  font-weight: 700;
  font-size: 16px;
  white-space: nowrap;
}

.ming-footer__lantern-sub{
  font-weight: 600;
  font-size: 12px;
  opacity: .9;
}

.ming-footer__logo{
  margin: 28px 0 22px;
  display: flex;
  justify-content: center;
}
.ming-footer__logo img{
  height: 70px;
  width: auto;
  opacity: .9;
}

.ming-footer__rule{
  height: 1px;
  width: min(780px, 86%);
  margin: 24px auto 18px;
  background: rgba(255,255,255,.28);
}

/* bottom row */
.ming-footer__bottom{
  display: flex;
  justify-content: space-between;
  align-items: flex-end;
  gap: 24px;
  width: 100%;
  margin-top: 10px;
}

.ming-footer__left{
  text-align: left;
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.ming-footer__copyright{
  font-size: 13px;
  color: rgba(255,255,255,.85);
}

.ming-footer__links{
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
}

.ming-footer__links a{
  font-size: 13px;
  color: rgba(255,255,255,.9);
  text-decoration: none;
}
.ming-footer__links a:hover{
  text-decoration: underline;
}

.ming-footer__payments{
  display: flex;
  gap: 10px;
  align-items: center;
  justify-content: flex-end;
}
.ming-footer__payments img{
  height: 18px;
  width: auto;
  opacity: .95;
}

/* responsive */
@media (max-width: 900px){
  .ming-footer__top-inner{ padding: 70px 0 34px; }
  .ming-footer__bottom{
    flex-direction: column;
    align-items: flex-start;
  }
  .ming-footer__payments{
    justify-content: flex-start;
  }
}
/* =========================
   MOBILE DRAWER NAV
========================= */

/* hamburger hidden on desktop */
.nav-toggle{
  display: none;
  margin-left: auto;
  width: 46px;
  height: 46px;
  border: 0;
  background: transparent;
  cursor: pointer;
  align-items: center;
  justify-content: center;
  color: rgba(255,255,255,.92); /* matches hero top */
}

/* when header is white (scrolled), hamburger becomes dark */
.hero__nav-wrapper.is-scrolled .nav-toggle{
  color: #444;
}

.nav-toggle__icon{
  position: relative;
  width: 24px;
  height: 2px;
  background: currentColor;
  display: block;
  border-radius: 99px;
}
.nav-toggle__icon::before,
.nav-toggle__icon::after{
  content:"";
  position:absolute;
  left:0;
  width:24px;
  height:2px;
  background: currentColor;
  border-radius: 99px;
}
.nav-toggle__icon::before{ top:-7px; }
.nav-toggle__icon::after{ top: 7px; }

/* Drawer base */
.mobile-drawer{
  position: fixed;
  inset: 0;
  z-index: 10050; /* above header/social */
  pointer-events: none;
  opacity: 0;
  transition: opacity .18s ease;
}

.mobile-drawer.is-open{
  opacity: 1;
  pointer-events: auto;
}

.mobile-drawer__backdrop{
  position: absolute;
  inset: 0;
  background: rgba(0,0,0,.45);
}

.mobile-drawer__panel{
  position: absolute;
  top: 0;
  right: 0;
  width: min(86vw, 360px);
  height: 100%;
  background: #fff;
  box-shadow: -20px 0 40px rgba(0,0,0,.18);
  transform: translateX(100%);
  transition: transform .22s ease;
  padding: 18px 18px 24px;
  display: flex;
  flex-direction: column;
  gap: 14px;
}

.mobile-drawer.is-open .mobile-drawer__panel{
  transform: translateX(0);
}

.mobile-drawer__close{
  margin-left: auto;
  width: 44px;
  height: 44px;
  border: 0;
  border-radius: 12px;
  background: rgba(0,0,0,.06);
  cursor: pointer;
  font-size: 20px;
}

.mobile-drawer__nav{
  display: flex;
  flex-direction: column;
  gap: 6px;
  padding-top: 6px;
}

.mobile-drawer__link{
  text-decoration: none;
  text-transform: uppercase;
  letter-spacing: .12em;
  font-weight: 600;
  font-size: 15px;
  color: #333;
  padding: 14px 12px;
  border-radius: 12px;
}

.mobile-drawer__link:hover{
  background: rgba(182,31,42,.08);
}

/* lock background scroll when drawer open */
body.drawer-open{
  overflow: hidden;
}

/* =========================
   SOCIAL BAR (RIGHT SIDE) - MOBILE TWEAK
========================= */

.social-bar{
  position: fixed;
  right: 18px;
  top: 50%;
  transform: translateY(-50%);
  display: flex;
  flex-direction: column;
  gap: 14px;
  z-index: 9998;
}

.social-bar__link{
  width: 50px;
  height: 50px;
  border-radius: 999px;
  background: #fff;
  display: grid;
  place-items: center;
  box-shadow: 0 10px 20px rgba(0,0,0,.12);
}

.social-bar__link img{

  object-fit: contain;
}

/* MOBILE BREAKPOINT */
@media (max-width: 900px){
  /* hide the desktop horizontal menu and show hamburger */
  .hero__menu{ display: none; }
  .nav-toggle{ display: inline-flex; }

  /* keep header layout clean on mobile */
  .hero__nav{
    justify-content: space-between;
    gap: 14px;
  }

  /* slightly smaller social icons on mobile */
  .social-bar{
    right: 10px;
    gap: 10px;
  }
}

/* REMOVE the TOP red line everywhere (active + inactive) */
.hero__menu-link::before,
.hero__menu-link span::before{
  content: none !important;
  display: none !important;
}

/* If that top line was drawn as a border or inset shadow, kill it too */
.hero__menu-link,
.hero__menu-link span{
  border-top: 0 !important;
  box-shadow: none !important;
}

/* ===== Speisekarte iframe integration ===== */
.menu-frame-wrap{
  position: relative;
  width: 100%;          /* full width */
  max-width: none;      /* üî• remove constraint */
  margin: 0;

  background: #fff;
  border-radius: 0;     /* optional: edge-to-edge look */
  overflow: hidden;
  box-shadow: none;
}


/* iframe itself */
.menu-frame{
  width: 100%;
  height: 82vh;
  border: 0;
  display: block;
  background: #fff;
}

/* Mobile polish */
@media (max-width: 900px){
  .menu-frame{
    height: 78vh;
  }
}

html{
  scroll-behavior: auto;
}

@media (prefers-reduced-motion: no-preference){
  html{
    scroll-behavior: smooth;
  }
}


.menu-frame{
  overflow: hidden;
}

/* Fix anchor scroll position for fixed header */
#speisekarte{
  scroll-margin-top: 20px; /* adjust to your header height */
}


.menu-frame{
  position: relative;
  z-index: 10;
  pointer-events: auto;
}
.menu-frame{
  touch-action: manipulation;
}

.menu-section {
  background: #fff;     /* white everywhere */
  padding: 0;           /* ‚ùå remove side & top space */
  margin: 0;            /* ‚ùå remove outer gaps */
}

/* ===== Reservation Modal (Jannowitz) ===== */
.resv-modal{
  position: fixed;
  inset: 0;
  z-index: 22000; /* above header/social */
  display: none;
}
.resv-modal.is-open{ display:block; }

.resv-modal__backdrop{
  position: absolute;
  inset: 0;
  background: rgba(0,0,0,.55);
}

.resv-modal__panel{
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  width: min(760px, 92vw);
  background: rgba(255,255,255,.95);
  box-shadow: 0 30px 80px rgba(0,0,0,.40);
  border-radius: 18px;
  padding: 18px;
}

.resv-modal__close{
  margin-left: auto;
  display: block;
  width: 44px;
  height: 44px;
  border: 0;
  border-radius: 12px;
  background: rgba(0,0,0,.06);
  cursor: pointer;
  font-size: 18px;
}

.resv-modal__title{
  margin: 10px 0 4px;
  font-size: 24px;
  font-weight: 800;
  color: #111;
}
.resv-modal__subtitle{
  margin: 0 0 14px;
  color: rgba(0,0,0,.65);
  font-size: 14px;
}

.resv-popup{
  position: fixed;
  inset: 0;
  z-index: 23000;
  display: none;
}
.resv-popup.is-open{ display:block; }

.resv-popup__backdrop{
  position: absolute;
  inset: 0;
  background: rgba(0,0,0,.55);
}

.resv-popup__panel{
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  width: min(520px, 92vw);
  background: rgba(255,255,255,.96);
  border-radius: 18px;
  padding: 18px;
  box-shadow: 0 30px 80px rgba(0,0,0,.40);
}

.resv-popup__title{
  margin: 0 0 8px;
  font-size: 18px;
  font-weight: 900;
  color:#111;
}
.resv-popup__text{
  margin: 0 0 14px;
  color: rgba(0,0,0,.72);
}
.resv-popup__actions{
  display:flex;
  justify-content:flex-end;
}

.form-field select{
  width: 100%;
  border-radius: 14px;
  border: 1px solid rgba(0,0,0,.15);
  padding: 10px 12px;
  font-size: 14px;
  outline: none;
  background: rgba(255,255,255,.95);
}

select option:disabled{
  color: rgba(0,0,0,.45);
}

    .resv-table{
    width: 100%;
    border-collapse: separate;
    border-spacing: 0;
    table-layout: fixed;        /* ‚úÖ key */
    }

    .resv-table th,
    .resv-table td{
    padding: 14px 16px;
    border-bottom: 1px solid rgba(0,0,0,.06);
    vertical-align: middle;
    text-align: left;
    white-space: nowrap;        /* keeps columns aligned */
    overflow: hidden;
    text-overflow: ellipsis;    /* long values don't break layout */
    }

    .resv-table thead th{
    font-weight: 800;
    color: rgba(0,0,0,.65);
    background: rgba(255,255,255,.70);
    }

    .resv-table tbody tr:last-child td{
    border-bottom: 0;
    }

.resv-table td:nth-child(5){
  font-variant-numeric: tabular-nums;
}

.resv-popup__actions {
  display: flex;
  gap: 12px;        /* space between buttons */
  align-items: center;
}

/* allow events on our special disabled days */
.flatpickr-day.short-term-call {
  pointer-events: auto !important;
}

/* keep the "disabled" look and show it's not selectable */
.flatpickr-day.short-term-call.flatpickr-disabled {
  cursor: not-allowed;
}


  </style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

<script>
function computeMinReservableDate(closingHHMM) {
  const now = new Date();

  const today = new Date(now);
  today.setHours(0, 0, 0, 0);

  const [ch, cm] = (closingHHMM || "22:00").split(":").map(Number);
  const closingToday = new Date(now);
  closingToday.setHours(ch || 0, cm || 0, 0, 0);

  // after closing -> earliest is tomorrow
  if (now > closingToday) {
    const tomorrow = new Date(today);
    tomorrow.setDate(today.getDate() + 1);
    return tomorrow;
  }

  return today;
}

function formatDate(d) {
  const yyyy = d.getFullYear();
  const mm = String(d.getMonth()+1).padStart(2,'0');
  const dd = String(d.getDate()).padStart(2,'0');
  return `${yyyy}-${mm}-${dd}`;
}

function getShortTermDisabledDays(daysInAdvance) {
  const result = [];

  const today = new Date();
  today.setHours(0,0,0,0);

  for (let i = 0; i < daysInAdvance; i++) {
    const d = new Date(today);
    d.setDate(today.getDate() + i);
    result.push(formatDate(d));
  }

  return result;
}
window.OPENING_TIME = "{{ opening_time|default:'12:00' }}";   // "HH:MM"
window.CLOSING_TIME = "{{ closing_time|default:'22:00' }}";   // "HH:MM"
document.addEventListener("DOMContentLoaded", () => {
  const select = document.getElementById("id_time");

  const startHour = parseInt(window.OPENING_TIME.split(":")[0]); // opening time
  const endHour   = parseInt(window.CLOSING_TIME.split(":")[0]); // closing time
  for (let hour = startHour; hour <= endHour; hour++) {

    for (let min = 0; min < 60; min += 15) {

      // skip 22:15, 22:30 etc if restaurant closes at 22:00
      if (hour === endHour && min > 0) break;

      const hh = String(hour).padStart(2, "0");
      const mm = String(min).padStart(2, "0");

      const time = `${hh}:${mm}`;

      const option = document.createElement("option");
      option.value = time;
      option.textContent = time;

      select.appendChild(option);

    }
  }
  const input = document.getElementById("jannowitz-date");
  const hint = document.getElementById("shortTermHint");
  if (!input || !hint || !window.flatpickr) return;


  const canHover = window.matchMedia("(hover: hover) and (pointer: fine)").matches;

  function ymd(d) {
    const yyyy = d.getFullYear();
    const mm = String(d.getMonth() + 1).padStart(2, "0");
    const dd = String(d.getDate()).padStart(2, "0");
    return `${yyyy}-${mm}-${dd}`;
  }

const shortTermDisabledDates = getShortTermDisabledDays(window.daysInAdvance);

  let hideTimer = null;
  function showHint() {
    clearTimeout(hideTimer);
    // on mobile, auto-hide after a moment
    hideTimer = setTimeout(() => (hint.style.display = "none"), 2800);
  }
  function hideHintNow() {
    clearTimeout(hideTimer);
    hint.style.display = "none";
  }

const minDateObj = computeMinReservableDate(window.CLOSING_TIME || "22:00");

const shortTermKeys = new Set(shortTermDisabledDates);

flatpickr(input, {
  dateFormat: "Y-m-d",
  altInput: true,
  altFormat: "d.m.Y",

  // ‚úÖ blocks all past dates (and blocks today if now > closing time)
  minDate: minDateObj,

  // ‚úÖ keep your short-term disabled logic
  disable: [
    // safety: also disable anything before minDate (even if minDate changes)
    function(date) {
      const d = new Date(date);
      d.setHours(0,0,0,0);
      return d < minDateObj;
    },

    ...shortTermDisabledDates,
  ],

  onDayCreate: function (_dObj, _dStr, _fp, dayElem) {
    const key = ymd(dayElem.dateObj);

    // ‚úÖ IMPORTANT: only attach tooltip to short-term disabled dates
    if (!shortTermKeys.has(key)) return;

    dayElem.classList.add("short-term-call");
    dayElem.setAttribute("title", "Kurzfristig? Bitte telefonisch reservieren. 030 - 308 756 80");

    if (canHover) {
      dayElem.addEventListener("mouseenter", showHint);
      dayElem.addEventListener("mouseleave", hideHintNow);
    } else {
      const tapHandler = (e) => {
        e.preventDefault();
        e.stopPropagation();
        showHint();
      };
      dayElem.addEventListener("touchstart", tapHandler, { passive: false });
      dayElem.addEventListener("click", tapHandler);
    }
  },

  onClose: hideHintNow,
  onChange: hideHintNow,
  onOpen: hideHintNow
});


  // hide when user taps elsewhere on mobile
  document.addEventListener("touchstart", (e) => {
    if (!hint.contains(e.target)) hideHintNow();
  }, { passive: true });
});

(function () {
  const mount = document.getElementById("myResvInline");
  if (!mount) return;

function applyRidFilter() {
  const rid = new URLSearchParams(window.location.search).get("rid");
  if (!rid) return;

  const rows = mount.querySelectorAll("[data-reservation-id]");
  if (!rows.length) return;

  let found = false;

  rows.forEach((row) => {
    if (row.getAttribute("data-reservation-id") === String(rid)) {
      row.style.display = "";
      found = true;
    } else {
      row.style.display = "none";
    }
  });

  if (!found) return;

  const row = mount.querySelector(`[data-reservation-id="${rid}"]`);
  if (!row) return;

  // ‚úÖ only scroll + highlight (NO edit auto-open)
  row.scrollIntoView({ behavior: "smooth", block: "center" });
  row.classList.add("resv-highlight");
  setTimeout(() => row.classList.remove("resv-highlight"), 5000);
}

  function setInlineHTML(html){
    mount.innerHTML = html;
    bindInlineHandlers();
     applyRidFilter();
    // ‚úÖ IMPORTANT: if edit form is now visible, re-init widgets
    const editForm = mount.querySelector("#resvEditForm");
    if (editForm) {
      const opening = editForm.getAttribute("data-opening-time");
      const closing = editForm.getAttribute("data-closing-time");
      initEditReservationModal(mount, opening, closing);
    }
  }

  async function loadStartOrMy(){
    console.log('loadStartOrMy called');
    const res = await fetch("/reservations/start-modal/", {
      headers: {"X-Requested-With": "XMLHttpRequest"}
    });
    const data = await res.json();
    setInlineHTML(data.html);
  }

async function loadMy(){
  await showMyList();
}


  function setButtonLoading(btn, loading){
    if (!btn) return;
    btn.disabled = loading;

    if (loading){
      btn.dataset.originalText = btn.textContent;
      btn.textContent = "loading...";
      btn.classList.add("is-loading");
    } else {
      btn.textContent = btn.dataset.originalText || btn.textContent;
      btn.classList.remove("is-loading");
    }
  }

async function showMyList(){
  const res = await fetch("/reservations/my-modal/", {
    headers: {"X-Requested-With":"XMLHttpRequest"}
  });
  const data = await res.json();
  console.log('datadata',data);
  setInlineHTML(data.html);   // ‚úÖ important
}


function initEditReservationModal(modalRoot, opening, closing) {
  // ---- pick correct elements (EDIT!) ----
  const dateInput = modalRoot.querySelector("#edit-date");     // ‚úÖ FIX (was jannowitz-date)
  const timeSelect = modalRoot.querySelector("#edit-time");
  const currentTime = (modalRoot.querySelector("#edit-time-current")?.value || "").trim();

  // fallback opening/closing (because AJAX often returns only html)
  opening = (opening || window.OPENING_TIME || "12:00").trim();
  closing = (closing || window.CLOSING_TIME || "22:00").trim();

  // ---------- helpers ----------
  const toMinutes = (hhmm) => {
    const [h, m] = (hhmm || "0:0").split(":").map(Number);
    return (h * 60) + (m || 0);
  };
  const toHHMM = (mins) => {
    const h = String(Math.floor(mins / 60)).padStart(2, "0");
    const m = String(mins % 60).padStart(2, "0");
    return `${h}:${m}`;
  };
  const ymd = (d) => {
    const yyyy = d.getFullYear();
    const mm = String(d.getMonth() + 1).padStart(2, "0");
    const dd = String(d.getDate()).padStart(2, "0");
    return `${yyyy}-${mm}-${dd}`;
  };

  // ‚úÖ same rule you use in create form
  const minDateObj = computeMinReservableDate(closing);

  // short-term disabled days: reuse your existing generator
  // NOTE: daysInAdvance should exist globally in your page already
  const daysInAdvance = window.daysInAdvance || 3;
  const shortTermDisabledDates = getShortTermDisabledDays(daysInAdvance);
  const shortTermKeys = new Set(shortTermDisabledDates);

  // Create a hint element (like create form) if not present
  let hint = modalRoot.querySelector("#shortTermHintEdit");
  if (!hint) {
    hint = document.createElement("div");
    hint.id = "shortTermHintEdit";
    hint.style.cssText = `
      position: fixed;
      display: none;
      z-index: 999999;
      left: 50%;
      bottom: 24px;
      transform: translateX(-50%);
      max-width: 92vw;
      padding: 10px 12px;
      border-radius: 12px;
      background: rgba(20,20,20,0.95);
      color: #fff;
      font-size: 14px;
      line-height: 1.35;
      box-shadow: 0 10px 30px rgba(0,0,0,0.25);
    `;
    hint.textContent = "Kurzfristig reservieren? Bitte telefonisch: 030 - 308 756 80";
    modalRoot.appendChild(hint);
  }

  const canHover = window.matchMedia("(hover: hover) and (pointer: fine)").matches;

  let hideTimer = null;
  function showHint() {
    hint.style.display = "block";
    clearTimeout(hideTimer);
    hideTimer = setTimeout(() => (hint.style.display = "none"), 2800);
  }
  function hideHintNow() {
    clearTimeout(hideTimer);
    hint.style.display = "none";
  }

  // ---------- init flatpickr for EDIT ----------
  if (dateInput && window.flatpickr) {
    flatpickr(dateInput, {
      dateFormat: "Y-m-d",
      altInput: true,
      altFormat: "d.m.Y",

      // keep existing selected value
      defaultDate: dateInput.value || null,

      // ‚úÖ blocks past dates (and blocks today if now > closing)
      minDate: minDateObj,

      disable: [
        // safety: block anything before minDate
        function(date) {
          const d = new Date(date);
          d.setHours(0,0,0,0);
          return d < minDateObj;
        },
        ...shortTermDisabledDates,
      ],

      onDayCreate: function (_dObj, _dStr, _fp, dayElem) {
        const key = ymd(dayElem.dateObj);
        if (!shortTermKeys.has(key)) return;

        // allow pointer events to show hint (even if disabled)
        dayElem.classList.add("short-term-call");
        dayElem.setAttribute("title", "Kurzfristig? Bitte telefonisch reservieren. 030 - 308 756 80");

        if (canHover) {
          dayElem.addEventListener("mouseenter", showHint);
          dayElem.addEventListener("mouseleave", hideHintNow);
        } else {
          const tapHandler = (e) => {
            e.preventDefault();
            e.stopPropagation();
            showHint();
          };
          dayElem.addEventListener("touchstart", tapHandler, { passive: false });
          dayElem.addEventListener("click", tapHandler);
        }
      },

      onClose: hideHintNow,
      onChange: hideHintNow,
      onOpen: hideHintNow,
    });
  }

  // ---------- build 15-min times for EDIT ----------
  if (timeSelect) {
    const start = toMinutes(opening);
    const end = toMinutes(closing);

    timeSelect.innerHTML = `<option value="">Bitte Uhrzeit w√§hlen</option>`;

    for (let t = start; t <= end; t += 15) {
      const v = toHHMM(t);
      const opt = document.createElement("option");
      opt.value = v;
      opt.textContent = v;
      if (currentTime && v === currentTime) opt.selected = true;
      timeSelect.appendChild(opt);
    }

    // edge-case: keep current time if outside range
    if (currentTime && !Array.from(timeSelect.options).some(o => o.value === currentTime)) {
      const opt = document.createElement("option");
      opt.value = currentTime;
      opt.textContent = currentTime + " (aktuell)";
      opt.selected = true;
      timeSelect.appendChild(opt);
    }
  }

  console.log("‚úÖ Edit init OK:", { opening, closing, currentTime });
}

async function showEditForm(id){
  const res = await fetch(`/reservations/edit/${id}/`, {
    headers: {"X-Requested-With":"XMLHttpRequest"}
  });
  const data = await res.json();

  // render edit HTML
  mount.innerHTML = data.html;

  // ‚úÖ init using global opening/closing (works even if backend doesn't send them)
  initEditReservationModal(mount, window.OPENING_TIME, window.CLOSING_TIME);
if (!data.ok) {
  // optional: scroll to the error
  const err = mount.querySelector(".form-error");
  if (err) err.scrollIntoView({ behavior:"smooth", block:"center" });
}
}

function getCookie(name) {
  const value = `; ${document.cookie}`;
  const parts = value.split(`; ${name}=`);
  if (parts.length === 2) return parts.pop().split(";").shift();
  return "";
}

async function postUpdate(url, formEl){
  const res = await fetch(url, {
    method: "POST",
    body: new FormData(formEl),
    headers: {"X-Requested-With":"XMLHttpRequest"}
  });
  const data = await res.json();
  return { ok: res.ok && data.ok, data, status: res.status };
}

function bindInlineHandlers() {
  // 1) Bind the AUTH form submit (only if the form exists in the current HTML)
  const authForm = document.getElementById("resvAuthForm");
  if (authForm && !authForm.dataset.bound) {
    authForm.dataset.bound = "1";

authForm.addEventListener("submit", async (ev) => {
  ev.preventDefault();

  const emailInput = authForm.querySelector('input[name="email"]');
  const btn = authForm.querySelector('button[type="submit"]');
  const msg = document.getElementById("resvAuthMsg");

  const payload = { email: (emailInput?.value || "").trim() };

  // basic UI validation
  if (!payload.email) {
    if (msg) msg.innerHTML = `<div class="resv-inline-notice resv-inline-notice--err">Bitte E-Mail eingeben.</div>`;
    return;
  }

  // ‚úÖ show loader immediately
  setButtonLoading(btn, true);
  if (emailInput) emailInput.disabled = true;
  if (msg) msg.innerHTML = "";

  try {
    const res = await fetch("/reservations/send-link/", {
      method: "POST",
      credentials: "same-origin",
      headers: {
        "Content-Type": "application/json",
        "X-Requested-With": "XMLHttpRequest",
        "X-CSRFToken": getCookie("csrftoken"),
      },
      body: JSON.stringify(payload),
    });

    const data = await res.json().catch(() => ({}));

    if (data.html) {
      setInlineHTML(data.html);
    } else if (data.redirect) {
      window.location.href = data.redirect;
    } else if (!res.ok) {
      if (msg) msg.innerHTML = `<div class="resv-inline-notice resv-inline-notice--err">Konnte Link nicht senden. Bitte pr√ºfen Sie die E-Mail.</div>`;
      console.error("Auth failed:", res.status, data);
    }
  } catch (err) {
    console.error("Auth request error:", err);
    if (msg) msg.innerHTML = `<div class="resv-inline-notice resv-inline-notice--err">Netzwerkfehler. Bitte erneut versuchen.</div>`;
  } finally {
    // ‚úÖ hide loader when request finishes (success or error)
    setButtonLoading(btn, false);
    if (emailInput) emailInput.disabled = false;
  }
});

  }

  // 2) Bind CLICK + SUBMIT handlers ONCE on the mount (event delegation)
  if (!mount.dataset.inlineDelegationBound) {
    mount.dataset.inlineDelegationBound = "1";

    // CLICK delegation
    mount.addEventListener("click", (e) => {
      const editBtn = e.target.closest("[data-edit-resv]");
      if (editBtn) {
        const id = editBtn.getAttribute("data-edit-resv");
        if (id) showEditForm(id);
        return;
      }

      const backBtn = e.target.closest("[data-back-to-list]");
      if (backBtn) {
        showMyList();
        return;
      }
    });

mount.addEventListener("click", (e) => {
  const btn = e.target.closest("[data-edit-disabled]");
  if (!btn) return;

  e.preventDefault();

  const tip = btn.querySelector(".resv-tooltip");
  if (!tip) return;

  tip.style.opacity = "1";
  tip.style.visibility = "visible";

  clearTimeout(btn._tipTimer);
  btn._tipTimer = setTimeout(() => {
    tip.style.opacity = "";
    tip.style.visibility = "";
  }, 2200);
});


    // SUBMIT delegation (edit form)
    mount.addEventListener("submit", async (e) => {
      const editForm = e.target.closest("#resvEditForm");
      if (!editForm) return;

      e.preventDefault();

      const updateUrl = editForm.getAttribute("data-update-url");
      if (!updateUrl) {
        console.error("Missing data-update-url on #resvEditForm");
        return;
      }

      const btn = editForm.querySelector('button[type="submit"]');
      const msg = mount.querySelector("#resvEditMsg");

      if (msg) msg.innerHTML = "";
      if (btn) {
        btn.disabled = true;
        btn.textContent = "Speichern‚Ä¶";
      }

      try {
        const res = await fetch(updateUrl, {
          method: "POST",
          credentials: "same-origin",
          headers: {
            "X-Requested-With": "XMLHttpRequest",
            "X-CSRFToken": getCookie("csrftoken"),
          },
          body: new FormData(editForm),
        });

        // Backend returns JSON (even on 400)
        const data = await res.json().catch(() => ({}));

        // ‚úÖ If server sends HTML (form again, or "not allowed" screen), show it ALWAYS
        if (data && data.html) {
          setInlineHTML(data.html);
          return;
        }

        // Otherwise fallback message
        if (!res.ok) {
          if (msg) {
            msg.innerHTML = `<div class="resv-inline-notice resv-inline-notice--err">
              Fehler beim Speichern (Status ${res.status}).
            </div>`;
          }
          console.error("Update failed:", res.status, data);
          return;
        }

        // If ok but no html, just reload list
        await showMyList();
      } catch (err) {
        console.error("Update request error:", err);
        if (msg) {
          msg.innerHTML = `<div class="resv-inline-notice resv-inline-notice--err">
            Netzwerkfehler. Bitte erneut versuchen.
          </div>`;
        }
      } finally {
        const stillForm = mount.querySelector("#resvEditForm");
        if (stillForm) {
          const b = stillForm.querySelector('button[type="submit"]');
          if (b) {
            b.disabled = false;
            b.textContent = "√Ñnderungen speichern";
          }
        }
      }
    });
  }
}

  // Styles for loader + notices (insert once)
  const style = document.createElement("style");
  style.textContent = `
    .kontakt-card__btn.is-loading{
      position: relative;
      padding-right: 44px;
      opacity: .92;
      cursor: wait;
    }
    .kontakt-card__btn.is-loading::after{
      content: "";
      position: absolute;
      right: 16px;
      top: 50%;
      width: 16px;
      height: 16px;
      margin-top: -8px;
      border-radius: 50%;
      border: 2px solid rgba(255,255,255,.55);
      border-top-color: rgba(255,255,255,1);
      animation: spin 0.8s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    .resv-inline-notice{
      margin-top: 12px;
      padding: 12px 14px;
      border-radius: 14px;
      font-size: 14px;
      line-height: 1.45;
    }
    .resv-inline-notice--err{
      background: rgba(211,47,47,.10);
      border: 1px solid rgba(211,47,47,.25);
      color: #b71c1c;
    }
  `;
  document.head.appendChild(style);

const ridParam = new URLSearchParams(window.location.search).get("rid");

if (location.hash === "#my-reservations" || ridParam){
  loadMy();
} else {
  loadStartOrMy();
}

  // When clicking nav to #my-reservations, load content if not loaded yet
  document.addEventListener("click", (e) => {
    const a = e.target.closest('a[href="#my-reservations"]');
    if (!a) return;

    // Delay a bit so scroll happens first
    setTimeout(() => {
      // If cookie exists, show list; else show email form
      loadStartOrMy();
    }, 100);
  });
})();

function durationMinutesForParty(p){
  const n = parseInt(p, 10);
  if (!n || n < 1) return null;
  if (n <= 2) return 90;
  if (n <= 4) return 105;
  if (n <= 6) return 120;
  return 150;
}

function timeToMinutes(hhmm){
  const [h,m] = hhmm.split(":").map(Number);
  return h*60 + m;
}

function minutesToTime(min){
  const h = String(Math.floor(min/60)).padStart(2,"0");
  const m = String(min%60).padStart(2,"0");
  return `${h}:${m}`;
}

function overlaps(aStart, aEnd, bStart, bEnd){
  return aStart < bEnd && aEnd > bStart; // [start,end)
}

async function loadAvailableTimes(){
  const dateInput = document.getElementById("jannowitz-date");
  const partyInput = document.getElementById("jannowitz-party");
  const timeSelect = document.getElementById("jannowitz-time");
  if (!dateInput || !partyInput || !timeSelect) return;

  const dateVal = dateInput.value;
  const duration = durationMinutesForParty(partyInput.value);

  if (!dateVal || !duration){
    timeSelect.innerHTML = `<option value="">Bitte Datum + Personen w√§hlen</option>`;
    return;
  }

  // fetch existing occupied intervals
  const res = await fetch(`/reservations/availability/?date=${encodeURIComponent(dateVal)}`, {
    headers: { "X-Requested-With": "XMLHttpRequest" }
  });
  const data = await res.json();
  const intervals = (data.ok ? data.intervals : []).map(x => ({
    start: timeToMinutes(x.start),
    end: timeToMinutes(x.end)
  }));

  // Business hours
  const OPEN = timeToMinutes("12:00");
  const CLOSE = timeToMinutes("22:00");
  const STEP = 30;

  let options = `<option value="">Uhrzeit w√§hlen</option>`;
  let anyAvailable = false;

  for (let t = OPEN; t <= CLOSE; t += STEP){
    const start = t;
    const end = t + duration;

    // blocked if overlaps any existing interval
    let blocked = false;

    const hhmm = minutesToTime(t);

    if (blocked){
      options += `<option value="" disabled>${hhmm} (belegt)</option>`;
    } else {
      anyAvailable = true;
      options += `<option value="${hhmm}">${hhmm}</option>`;
    }
  }

  if (!anyAvailable){
    timeSelect.innerHTML = `<option value="">Keine Zeiten verf√ºgbar ‚Äì bitte anrufen</option>`;
    return;
  }

  timeSelect.innerHTML = options;
}

// Recompute times when date or party size changes
document.getElementById("jannowitz-date")?.addEventListener("change", loadAvailableTimes);
document.querySelector('input[name="party_size"]')?.addEventListener("input", () => {
  // wait for user to finish typing a bit
  clearTimeout(window.__partyTimer);
  window.__partyTimer = setTimeout(loadAvailableTimes, 250);
});

// Also recompute when modal opens (call this at end of openModal())

(function () {
  const daysInAdvance = {{ booking_days_in_advance|default:"3" }};
  window.daysInAdvance = daysInAdvance; // expose to global for debugging
  const modal = document.getElementById("jannowitzResvModal");
  if (!modal) return;

  function openModal(){
    console.log('sdvsdvsvsdvsd');
    modal.classList.add("is-open");
    modal.setAttribute("aria-hidden", "false");
    document.documentElement.style.overflow = "hidden";

    // set date min/max for "only 3 days in advance" (frontend only)
    const dateInput = document.getElementById("jannowitz-date");
    console.log('booking_days_in_advance', daysInAdvance);
    if (dateInput){
      const today = new Date();
      const max = new Date();
      max.setDate(today.getDate() + daysInAdvance);

      dateInput.min = toISO(max);
    }
    loadAvailableTimes();
  }

  function closeModal(){
    modal.classList.remove("is-open");
    modal.setAttribute("aria-hidden", "true");
    document.documentElement.style.overflow = "";
  }

  function toISO(d){
    const yyyy = d.getFullYear();
    const mm = String(d.getMonth()+1).padStart(2,"0");
    const dd = String(d.getDate()).padStart(2,"0");
    return `${yyyy}-${mm}-${dd}`;
  }

  document.querySelectorAll("[data-open-jannowitz-resv]").forEach(btn => {
    btn.addEventListener("click", openModal);
  });

  modal.addEventListener("click", (e) => {
    if (e.target.matches("[data-resv-close]")) closeModal();
  });

  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape" && modal.classList.contains("is-open")) closeModal();
  });
})();

  document.addEventListener("click", e => {
    const iframe = document.querySelector(".menu-frame");
    if (!iframe) return;
    if (iframe.contains(e.target)) {
      iframe.focus();
    }
  });
(function () {
  const toggle = document.getElementById("navToggle");
  const drawer = document.getElementById("mobileDrawer");
  if (!toggle || !drawer) return;

  const closeTargets = drawer.querySelectorAll("[data-drawer-close]");
  const drawerLinks = drawer.querySelectorAll("a");

  function openDrawer(){
    drawer.classList.add("is-open");
    drawer.setAttribute("aria-hidden", "false");
    toggle.setAttribute("aria-expanded", "true");
    document.body.classList.add("drawer-open");
  }

  function closeDrawer(){
    drawer.classList.remove("is-open");
    drawer.setAttribute("aria-hidden", "true");
    toggle.setAttribute("aria-expanded", "false");
    document.body.classList.remove("drawer-open");
  }

  toggle.addEventListener("click", () => {
    if (drawer.classList.contains("is-open")) closeDrawer();
    else openDrawer();
  });

  closeTargets.forEach(el => el.addEventListener("click", closeDrawer));
  drawerLinks.forEach(a => a.addEventListener("click", closeDrawer));

  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape" && drawer.classList.contains("is-open")) closeDrawer();
  });
})();

(function () {
  const grid = document.getElementById("guestbookGrid");
  if (!grid) return;

  const tiles = Array.from(grid.querySelectorAll(".guestbook-tile"));
  const quoteTiles = Array.from(grid.querySelectorAll(".guestbook-tile--quote"));
  const photoTiles = Array.from(grid.querySelectorAll(".guestbook-tile--photo"));

  const tDataEl = document.getElementById("guestbookTestimonials");
  const iDataEl = document.getElementById("guestbookImages");
  if (!tDataEl || !iDataEl) return;

  const testimonials = JSON.parse(tDataEl.textContent || "[]").filter(x => x && x.quote);
  const images = JSON.parse(iDataEl.textContent || "[]").filter(Boolean);
  if (!testimonials.length || !images.length) return;

  // Fill once (no swapping)
  let tIndex = 0, iIndex = 0;

  quoteTiles.forEach(tile => {
    const t = testimonials[tIndex++ % testimonials.length];
    tile.querySelector(".guestbook-text").textContent = `‚Äú${t.quote}‚Äù`;
    tile.querySelector(".guestbook-author").textContent = t.author || "";
  });

  photoTiles.forEach(tile => {
    const img = tile.querySelector("img");
    img.src = images[iIndex++ % images.length];
  });

  // Stagger delays like the video
  tiles.forEach((tile, idx) => tile.style.setProperty("--d", `${idx * 60}ms`));

  // Reveal once on scroll into view
  const io = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        tiles.forEach(t => t.classList.add("is-revealed"));
        io.disconnect();
      }
    });
  }, { threshold: 0.25 });

  io.observe(grid);
})();
(function () {
  const items = Array.from(document.querySelectorAll(".gallery-grid__item img"));
  if (!items.length) return;

  const lb = document.getElementById("galleryLightbox");
  const lbImg = document.getElementById("galleryLightboxImg");
  const lbCounter = document.getElementById("galleryLightboxCounter");

  let index = 0;

  function render() {
    lbImg.src = items[index].src;
    lbCounter.textContent = `${index + 1}/${items.length}`;
  }

  function openAt(i) {
    index = i;
    render();
    lb.classList.add("is-open");
    lb.setAttribute("aria-hidden", "false");
    document.documentElement.style.overflow = "hidden";
  }

  function close() {
    lb.classList.remove("is-open");
    lb.setAttribute("aria-hidden", "true");
    document.documentElement.style.overflow = "";
  }

  function prev() {
    index = (index - 1 + items.length) % items.length;
    render();
  }

  function next() {
    index = (index + 1) % items.length;
    render();
  }

  // open on click
  items.forEach((img, i) => {
    img.style.cursor = "pointer";
    img.addEventListener("click", () => openAt(i));
  });

  // buttons / backdrop close
  lb.addEventListener("click", (e) => {
    if (e.target.matches("[data-glb-close]")) close();
    if (e.target.matches("[data-glb-prev]")) prev();
    if (e.target.matches("[data-glb-next]")) next();
  });

  // keyboard
  window.addEventListener("keydown", (e) => {
    if (!lb.classList.contains("is-open")) return;

    if (e.key === "Escape") close();
    if (e.key === "ArrowLeft") prev();
    if (e.key === "ArrowRight") next();
  });
})();
(function () {
  const header = document.getElementById("siteHeader");
  const links = Array.from(document.querySelectorAll(".hero__menu-link"));
  if (!header) return;

  function setScrolled() {
    header.classList.toggle("is-scrolled", window.scrollY > 180);
  }

  function setActive(hash) {
    links.forEach(a => a.classList.toggle("is-active", a.getAttribute("href") === hash));
  }

  setScrolled();
  setActive(location.hash || "#start");

  window.addEventListener("scroll", setScrolled, { passive: true });
  window.addEventListener("hashchange", () => setActive(location.hash || "#start"));

  links.forEach(a => a.addEventListener("click", () => setActive(a.getAttribute("href"))));
})();
const callPopup = document.getElementById("resvCallPopup");

function openCallPopup(){
  if (!callPopup) return;
  callPopup.classList.add("is-open");
  callPopup.setAttribute("aria-hidden", "false");
}

function closeCallPopup(){
  if (!callPopup) return;
  callPopup.classList.remove("is-open");
  callPopup.setAttribute("aria-hidden", "true");
}

if (callPopup){
  callPopup.addEventListener("click", (e) => {
    if (e.target.matches("[data-call-close]")) closeCallPopup();
  });
}

(function () {
  const form = document.getElementById("jannowitz-form");
  if (!form) return;

  const btn = document.getElementById("jannowitz-submit");
  const btnText = btn.querySelector(".btn-text");
  const btnLoader = btn.querySelector(".btn-loader");
  const statusBox = document.getElementById("jannowitz-status");
  if (!statusBox) return;

  function setLoading(isLoading) {
    btn.disabled = isLoading;
    btnText.style.display = isLoading ? "none" : "inline";
    btnLoader.style.display = isLoading ? "inline" : "none";
  }

  function showStatus(html, ok=true) {
    statusBox.innerHTML = html;
    statusBox.className = ok ? "form-status form-status--ok" : "form-status form-status--err";
  }

  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    statusBox.innerHTML = "";

    setLoading(true);

    try {
      console.log('form.action',form.action);
      const res = await fetch(form.action, {
        method: "POST",
        body: new FormData(form),
        headers: {
          "X-Requested-With": "XMLHttpRequest",
        }
      });

      const data = await res.json();

      if (data.ok) {
        showStatus(data.message, true);
        form.reset();
      }
      else{
        console.log('datadata',data.popup);
        if (data.popup) {
          document.getElementById("resvPopupTitle").textContent = data.popup.title;
          document.getElementById("resvPopupText").innerHTML = data.popup.text;

          document.getElementById("resvCallPopup").classList.add("is-open");
        }
      }
    } catch (err) {
      showStatus("Serverfehler. Bitte versuchen Sie es erneut.", false);
    } finally {
      setLoading(false);
    }
  });
})();

(function () {
  const slides = document.querySelectorAll('.hero__slide');
  let activeIndex = 0;
  function showNextSlide() {
    slides[activeIndex].classList.remove('is-active');
    activeIndex = (activeIndex + 1) % slides.length;
    slides[activeIndex].classList.add('is-active');
  }
  if (slides.length > 1) {
    setInterval(showNextSlide, 6000);
  }
}());
  </script>
{% endblock %}
