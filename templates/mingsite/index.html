{% extends "mingsite/base.html" %}
{% load static %}
{% block title %}Ming Dynastie – Chinesisches Restaurant{% endblock %}

{% block content %}
  <section class="hero" id="start" aria-labelledby="hero-title">
    <div class="hero__slides" role="presentation">
      {% for slide in hero.slides %}
        {% with slide.image as img %}
          {% if img|slice:':4' == 'http' %}
            {% with resolved=img %}
              <div class="hero__slide{% if forloop.first %} is-active{% endif %}" style="background-image: url('{{ resolved }}');">
                <img src="{{ resolved }}" alt="{{ slide.alt }}">
              </div>
            {% endwith %}
          {% else %}
            {% static img as resolved %}
            <div class="hero__slide{% if forloop.first %} is-active{% endif %}" style="background-image: url('{{ resolved }}');">
              <img src="{{ resolved }}" alt="{{ slide.alt }}">
            </div>
          {% endif %}
        {% endwith %}
      {% endfor %}
    </div>
    <div class="hero__overlay hero__overlay--gradient"></div>
    <div class="hero__nav-wrapper">
      <div class="hero__nav container">
        <div class="hero__social">
          {% for social in hero.social_links %}
          <a class="hero__social-link hero__social-link--{{ social.slug }}"
            href="{{ social.href }}" title="{{ social.title }}" target="_blank" rel="noopener">
              {% static social.icon as icon_path %}
              <img src="{{ icon_path }}" alt="{{ social.title }}">
          </a>

          {% endfor %}
        </div>
        <nav class="hero__menu">
          {% for item in hero.nav_links %}
            <a class="hero__menu-link" href="{{ item.href }}">{{ item.label }}</a>
          {% endfor %}
        </nav>
        <div class="hero__contact">
          {% for link in hero.contact_links %}
            {% if link.type == 'phone' %}
              <a class="hero__contact-link" href="{{ link.href }}" title="{{ link.title }}">
                <svg viewBox="0 0 512 512" aria-hidden="true"><path d="M391 351l-57-25c-10-4-22-1-28 7l-25 32c-66-33-120-87-153-153l32-25c8-6 11-18 7-28l-25-57c-7-16-26-22-40-12l-43 29c-9 6-14 17-12 28 30 159 159 288 318 318 11 2 22-3 28-12l29-43c10-14 4-33-12-40z"/></svg>
                <span>{{ link.display }}</span>
              </a>
            {% endif %}
          {% endfor %}
        </div>
      </div>
    </div>
    <div class="hero__content container">
      <div class="hero__lead">
        <div class="hero__lead-logo">
          {% static hero.logo as hero_logo %}
          <img src="{{ hero_logo }}" alt="Ming Dynastie Schriftzug">
        </div>
        <p class="hero__eyebrow">{{ hero.subheadline }}</p>
        <h1 class="hero__title" id="hero-title">{{ hero.headline }}</h1>
        <p class="hero__description">{{ hero.description }}</p>
        <hr class="hero__rule">
        <p class="hero__description hero__description--secondary">{{ hero.secondary_description }}</p>
        <div class="hero__actions">
          {% for cta in hero.ctas %}
            <a class="button{% if cta.variant == 'outline' %} button--outline{% endif %}" href="{{ cta.href }}">{{ cta.label }}</a>
          {% endfor %}
        </div>
      </div>
    </div>
  </section>

  <div class="social-bar">
    {% for social in hero.social_links %}
<a class="social-bar__link social-bar__link--{{ social.slug }}"
   href="{{ social.href }}" target="_blank" rel="noopener" title="{{ social.title }}">
    {% static social.icon as icon_path %}
    <img src="{{ icon_path }}" alt="{{ social.title }}">
</a>

    {% endfor %}
  </div>

  <section id="speisekarte" class="section section--catering">
    <div class="container catering-grid">
      {% for card in catering_cards %}
        <article class="catering-card catering-card--{{ card.align }}">
          <div class="catering-card__image">
            <img src="{{ card.image }}" alt="{{ card.title }}">
          </div>
          <div class="catering-card__content">
            <h2 class="catering-card__title">{{ card.title }}</h2>
            {% for paragraph in card.copy %}
              <p>{{ paragraph }}</p>
            {% endfor %}
            <a class="button button--rounded" href="{{ card.button.href }}">{{ card.button.label }}</a>
          </div>
        </article>
      {% endfor %}
    </div>
  </section>

  <section id="locations" class="section section--locations">
    <div class="container">
      <header class="section__header">
        <h2 class="section__title section__title--accent">Unsere Locations</h2>
      </header>
      <div class="card-grid location-grid">
        {% for location in locations %}
          <article class="location-card" id="{{ location.anchor }}">
            <div class="location-card__media">
              <img src="{{ location.image }}" alt="{{ location.name }}">
            </div>
            <div class="location-card__body">
              <h3 class="location-card__title">{{ location.name }}</h3>
              <hr class="location-card__rule">
              <ul class="location-card__details">
                {% for line in location.address_lines %}
                  <li>{{ line }}</li>
                {% endfor %}
                <li>{{ location.hours }}</li>
              </ul>
              <a class="link-arrow" href="{{ location.menu_href }}">{{ location.menu_label }}</a>
            </div>
          </article>
        {% endfor %}
      </div>
    </div>
  </section>

  <section id="delivery" class="section section--delivery">
    <div class="container">
      <header class="section__header">
        <p class="section__eyebrow">Takeaway &amp; Delivery</p>
        <h2 class="section__title">Lieferdienste</h2>
        <p class="section__subtitle">{{ delivery.note }}</p>
      </header>
      <div class="delivery-grid">
        {% for service in delivery.services %}
          <article class="delivery-card">
            <h3 class="delivery-card__title">{{ service.location }}</h3>
            <ul class="delivery-card__links">
              {% for link in service.links %}
                <li>
                  <a href="{{ link.url }}" target="_blank" rel="noopener">
                    {% if link.logo %}
                      {% static link.logo as partner_logo %}
                      <img src="{{ partner_logo }}" alt="{{ link.logo_alt|default:link.name }}">
                    {% endif %}
                    <span>{{ link.name }}</span>
                  </a>
                </li>
              {% endfor %}
            </ul>
          </article>
        {% endfor %}
      </div>
    </div>
  </section>

  <section id="feast" class="section section--feast">
    <div class="container feast-grid">
      <div class="feast-grid__media">
        {% for image in feast.images %}
          <div class="feast-grid__image">
            <img src="{{ image }}" alt="{{ feast.title }}">
          </div>
        {% endfor %}
      </div>
      <div class="feast-grid__content">
        <h2 class="section__title section__title--light">{{ feast.title }}</h2>
        <p>{{ feast.description }}</p>
        <div class="feast-grid__actions">
          {% for link in feast.menu_links %}
            <a class="button button--outline-light" href="{{ link.url }}">{{ link.label }}</a>
          {% endfor %}
        </div>
      </div>
    </div>
  </section>

  <section id="galerie" class="section section--gallery">
    <div class="container">
      <header class="section__header">
        <h2 class="section__title section__title--light">Galerie</h2>
      </header>
      <div class="gallery-grid">
        {% for image in gallery_images %}
          <figure class="gallery-grid__item">
            <img src="{{ image }}" alt="Ming Dynastie Impression">
          </figure>
        {% endfor %}
      </div>
    </div>
  </section>

  <section class="section section--testimonials">
    <div class="container">
      <header class="section__header">
        <h2 class="section__title section__title--accent">Kundenmeinungen aus unserem Gästebuch</h2>
      </header>
      <div class="testimonial-carousel">
        {% for testimonial in testimonials %}
          <article class="testimonial-card">
            <blockquote>“{{ testimonial.quote }}”</blockquote>
            {% if testimonial.author %}
              <p class="testimonial-card__author">{{ testimonial.author }}</p>
            {% endif %}
          </article>
        {% endfor %}
      </div>
    </div>
  </section>

  <section id="kontakt" class="section section--contact">
    <div class="container contact-grid">
      {% for reservation in reservations %}
        <div class="contact-card" id="{{ reservation.id }}">
          <h3>{{ reservation.title }}</h3>
          <ul class="contact-card__details">
            <li><strong>Adresse:</strong> {{ reservation.address }}</li>
            <li><strong>Telefon:</strong> <a href="tel:{{ reservation.phone|cut:' ' }}">{{ reservation.phone }}</a></li>
            <li><strong>E-Mail:</strong> <a href="mailto:{{ reservation.email }}">{{ reservation.email }}</a></li>
          </ul>
          <form class="contact-card__form" method="post" action="#">
            {% csrf_token %}
            <div class="form-grid">
              <label>
                <span>Name*</span>
                <input type="text" name="name" required>
              </label>
              <label>
                <span>E-Mail*</span>
                <input type="email" name="email" required>
              </label>
              <label>
                <span>Telefon</span>
                <input type="tel" name="phone">
              </label>
              <label>
                <span>Datum*</span>
                <input type="date" name="date" required>
              </label>
              <label>
                <span>Uhrzeit*</span>
                <input type="time" name="time" required>
              </label>
              <label>
                <span>Personen*</span>
                <input type="number" name="guests" min="1" required>
              </label>
              <label class="form-grid__wide">
                <span>Nachricht (nicht für Reservierungen)*</span>
                <textarea name="message" rows="4" required></textarea>
              </label>
            </div>
            <button type="submit" class="button">Senden</button>
          </form>
        </div>
      {% endfor %}
    </div>
  </section>
{% endblock %}

{% block footer %}
  <footer class="site-footer">
    <div class="container site-footer__inner">
      <div class="site-footer__brand">
        {% static site_logo as footer_logo %}
        <img src="{{ footer_logo }}" alt="Ming Dynastie Logo">
        <p>&copy; {% now "Y" %} {{ footer.company }}</p>
      </div>
      <nav class="site-footer__nav">
        {% for link in footer.links %}
          <a href="{{ link.href }}">{{ link.label }}</a>
        {% endfor %}
      </nav>
      <div class="site-footer__payments">
        {% for icon in footer.payment_icons %}
          <img src="{{ icon }}" alt="Akzeptierte Zahlungsarten">
        {% endfor %}
      </div>
    </div>
  </footer>
{% endblock %}

{% block extra_scripts %}
  <script>
    (function () {
      const slides = document.querySelectorAll('.hero__slide');
      let activeIndex = 0;
      function showNextSlide() {
        slides[activeIndex].classList.remove('is-active');
        activeIndex = (activeIndex + 1) % slides.length;
        slides[activeIndex].classList.add('is-active');
      }
      if (slides.length > 1) {
        setInterval(showNextSlide, 6000);
      }
    }());
  </script>
{% endblock %}
